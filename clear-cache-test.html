<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Cache Test</title>
    
    <!-- Icons with cache-busting query parameters -->
    <link rel="apple-touch-icon" href="/icons/ios/180.png?v=2024-new">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/ios/32.png?v=2024-new">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/ios/16.png?v=2024-new">
    
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #2E3440; 
            color: #D8DEE9; 
            text-align: center;
        }
        .cache-info {
            background: #3B4252;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .icon-display {
            margin: 20px 0;
        }
        .icon-display img {
            border: 2px solid #4C566A;
            border-radius: 8px;
            margin: 10px;
        }
        .clear-btn {
            background: #BF616A;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        .clear-btn:hover {
            background: #D08770;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #A3BE8C; color: #2E3440; }
        .error { background: #BF616A; color: #ECEFF4; }
    </style>
</head>
<body>
    <h1>üßπ Cache Clearing Test</h1>
    
    <div class="cache-info">
        <h2>Cache Busting Icons</h2>
        <p>This page uses cache-busting query parameters (?v=2024-new) to force fresh icon downloads.</p>
        <p>If icons work here but not on main app, it's definitely a caching issue.</p>
    </div>
    
    <div class="icon-display">
        <h3>Fresh Icon Loading Test:</h3>
        <img src="/icons/ios/16.png?v=2024-new" width="32" height="32" alt="16x16 icon">
        <img src="/icons/ios/32.png?v=2024-new" width="64" height="64" alt="32x32 icon">
        <img src="/icons/ios/180.png?v=2024-new" width="128" height="128" alt="180x180 icon">
    </div>
    
    <div class="cache-info">
        <h3>üõ†Ô∏è Cache Clearing Tools</h3>
        <button class="clear-btn" onclick="clearAllCaches()">Clear All Caches</button>
        <button class="clear-btn" onclick="unregisterServiceWorker()">Unregister Service Worker</button>
        <button class="clear-btn" onclick="forceReload()">Force Reload</button>
        <div id="cache-status" class="status"></div>
    </div>
    
    <div class="cache-info">
        <h3>üì± Manual Steps for iOS Safari:</h3>
        <ol style="text-align: left;">
            <li><strong>Clear Safari Data:</strong> Settings ‚Üí Safari ‚Üí Clear History and Website Data</li>
            <li><strong>Force Close Safari:</strong> Double-tap home button, swipe up on Safari</li>
            <li><strong>Restart Safari:</strong> Open Safari fresh</li>
            <li><strong>Hard Refresh:</strong> Pull down to refresh on mobile</li>
            <li><strong>Test Add to Home Screen:</strong> Try adding this page to home screen</li>
        </ol>
    </div>

    <script>
        const statusEl = document.getElementById('cache-status');
        
        function updateStatus(message, type = 'success') {
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            console.log(message);
        }
        
        async function clearAllCaches() {
            try {
                updateStatus('üßπ Clearing all caches...', 'info');
                
                // Clear all cache storage
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(
                        cacheNames.map(cacheName => {
                            console.log('Deleting cache:', cacheName);
                            return caches.delete(cacheName);
                        })
                    );
                    updateStatus(`‚úÖ Cleared ${cacheNames.length} cache(s)`);
                } else {
                    updateStatus('‚ö†Ô∏è Cache API not supported');
                }
            } catch (error) {
                updateStatus(`‚ùå Error clearing caches: ${error.message}`, 'error');
            }
        }
        
        async function unregisterServiceWorker() {
            try {
                if ('serviceWorker' in navigator) {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        await registration.unregister();
                        updateStatus('‚úÖ Service Worker unregistered');
                    } else {
                        updateStatus('‚ÑπÔ∏è No Service Worker to unregister');
                    }
                } else {
                    updateStatus('‚ö†Ô∏è Service Worker not supported');
                }
            } catch (error) {
                updateStatus(`‚ùå Error unregistering SW: ${error.message}`, 'error');
            }
        }
        
        function forceReload() {
            updateStatus('üîÑ Force reloading page...');
            // Force reload without cache
            window.location.reload(true);
        }
        
        // Test icon loading with cache busting
        console.log('üßπ Cache clearing test page loaded');
        console.log('üîÑ Testing icons with cache-busting parameters');
        
        const iconTests = [
            { src: '/icons/ios/16.png?v=2024-new', name: '16x16' },
            { src: '/icons/ios/32.png?v=2024-new', name: '32x32' },
            { src: '/icons/ios/180.png?v=2024-new', name: '180x180' }
        ];
        
        iconTests.forEach(test => {
            const img = new Image();
            img.onload = function() {
                console.log(`‚úÖ ${test.name} icon loaded successfully (cache-busted)`);
            };
            img.onerror = function() {
                console.error(`‚ùå ${test.name} icon failed to load (cache-busted)`);
            };
            img.src = test.src;
        });
    </script>
</body>
</html> 