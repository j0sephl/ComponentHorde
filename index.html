<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∏ Guitar Pedal Parts</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .part-selector, .stock-controls, .sort-controls, .action-buttons {
            margin: 20px 0;
        }
        select, button, input[type="file"] {
            padding: 8px;
            margin: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        .low-stock-warning {
            color: red;
            display: none;
            margin-top: 10px;
        }
        .part-list table {
            width: 100%;
            border-collapse: collapse;
        }
        .part-list th, .part-list td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .part-list th {
            background-color: #f2f2f2;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
        }
        .modal-content input {
            width: calc(100% - 16px);
            margin: 8px 0;
            padding: 8px;
        }
        .bom-results {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>üé∏ Guitar Pedal Parts</h1>
    <p style="text-align: center;">NFC Inventory System</p>
    <div class="container">
        <div class="part-selector">
            <select id="partSelect">
                <option value="">Select a Part</option>
            </select>
            <span id="currentStock">0</span>
            <span>Current Stock</span>
            <button id="reorderButton">üõí Reorder</button>
            <div id="lowStockWarning" class="low-stock-warning">
                ‚ö†Ô∏è Low stock! Consider reordering soon.
            </div>
        </div>
        <div class="stock-controls">
            <button onclick="showAddStockModal()">Add Stock</button>
            <button onclick="showRemoveStockModal()">Remove Stock</button>
        </div>
        <div class="sort-controls">
            <select id="sortSelect" onchange="renderPartList()">
                <option value="all">All Parts</option>
                <option value="nameAsc">Name A-Z</option>
                <option value="nameDesc">Name Z-A</option>
                <option value="quantityAsc">Quantity Low-High</option>
                <option value="quantityDesc">Quantity High-Low</option>
                <option value="lowStock">Low Stock First</option>
            </select>
        </div>
        <div class="part-list">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>SKU</th>
                        <th>Quantity</th>
                        <th>Low Stock Threshold</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="partList"></tbody>
            </table>
        </div>
        <div class="action-buttons">
            <button onclick="showAddPartModal()">+ Add New Part</button>
            <button onclick="exportToCsv()">üì§ Export Data</button>
            <button onclick="document.getElementById('importFile').click()">üì• Import Data</button>
            <input type="file" id="importFile" accept=".csv" style="display: none;" onchange="importFromCsv(event)">
            <button onclick="showBomModal()">üìã Compare BOM</button>
        </div>
    </div>

    <!-- Add New Part Modal -->
    <div id="addPartModal" class="modal">
        <div class="modal-content">
            <h2>Add New Part</h2>
            <input type="text" id="addPartName" placeholder="Part Name">
            <input type="text" id="addPartSku" placeholder="SKU">
            <input type="number" id="addPartQuantity" placeholder="Quantity" min="0">
            <input type="number" id="addPartThreshold" placeholder="Low Stock Threshold" min="0">
            <button onclick="addPart()">Add Part</button>
            <button onclick="closeModal('addPartModal')">Cancel</button>
        </div>
    </div>

    <!-- Edit Part Modal -->
    <div id="editPartModal" class="modal">
        <div class="modal-content">
            <h2>Edit Part</h2>
            <input type="hidden" id="editPartId">
            <input type="text" id="editPartName" placeholder="Part Name">
            <input type="text" id="editPartSku" placeholder="SKU">
            <input type="number" id="editPartQuantity" placeholder="Quantity" min="0">
            <input type="number" id="editPartThreshold" placeholder="Low Stock Threshold" min="0">
            <button onclick="savePartChanges()">Save Changes</button>
            <button onclick="closeModal('editPartModal')">Cancel</button>
        </div>
    </div>

    <!-- Delete Part Modal -->
    <div id="deletePartModal" class="modal">
        <div class="modal-content">
            <h2>Delete Part</h2>
            <p>Are you sure you want to delete <span id="deletePartName"></span>?</p>
            <input type="hidden" id="deletePartId">
            <button onclick="deletePart()">Delete</button>
            <button onclick="closeModal('deletePartModal')">Cancel</button>
        </div>
    </div>

    <!-- Add Stock Modal -->
    <div id="addStockModal" class="modal">
        <div class="modal-content">
            <h2>Add Stock</h2>
            <p>Add stock to <span id="addStockPartName"></span></p>
            <input type="number" id="addStockQuantity" placeholder="Quantity to Add" min="1">
            <button onclick="addStock()">Add Stock</button>
            <button onclick="closeModal('addStockModal')">Cancel</button>
        </div>
    </div>

    <!-- Remove Stock Modal -->
    <div id="removeStockModal" class="modal">
        <div class="modal-content">
            <h2>Remove Stock</h2>
            <p>Remove stock from <span id="removeStockPartName"></span></p>
            <input type="number" id="removeStockQuantity" placeholder="Quantity to Remove" min="1">
            <button onclick="removeStock()">Remove Stock</button>
            <button onclick="closeModal('removeStockModal')">Cancel</button>
        </div>
    </div>

    <!-- BOM Comparison Modal -->
    <div id="bomModal" class="modal">
        <div class="modal-content">
            <h2>Compare BOM</h2>
            <input type="file" id="bomFile" accept=".csv">
            <button onclick="compareBom()">Compare</button>
            <button onclick="closeModal('bomModal')">Cancel</button>
            <div id="bomResults" class="bom-results"></div>
        </div>
    </div>

    <script>
        let parts = JSON.parse(localStorage.getItem('parts')) || [];
        let selectedPartId = null;

        function saveParts() {
            localStorage.setItem('parts', JSON.stringify(parts));
        }

        function renderPartList() {
            const partList = document.getElementById('partList');
            const sortSelect = document.getElementById('sortSelect').value;
            let sortedParts = [...parts];

            if (sortSelect === 'nameAsc') {
                sortedParts.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortSelect === 'nameDesc') {
                sortedParts.sort((a, b) => b.name.localeCompare(a.name));
            } else if (sortSelect === 'quantityAsc') {
                sortedParts.sort((a, b) => a.quantity - b.quantity);
            } else if (sortSelect === 'quantityDesc') {
                sortedParts.sort((a, b) => b.quantity - a.quantity);
            } else if (sortSelect === 'lowStock') {
                sortedParts.sort((a, b) => {
                    const aLow = a.quantity <= a.threshold;
                    const bLow = b.quantity <= b.threshold;
                    if (aLow && !bLow) return -1;
                    if (!aLow && bLow) return 1;
                    return a.quantity - b.quantity;
                });
            }

            partList.innerHTML = '';
            sortedParts.forEach(part => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${part.name}</td>
                    <td>${part.sku}</td>
                    <td>${part.quantity}</td>
                    <td>${part.threshold}</td>
                    <td>
                        <button onclick="showEditPartModal('${part.id}')">Edit</button>
                        <button onclick="showDeletePartModal('${part.id}')">Delete</button>
                    </td>
                `;
                partList.appendChild(tr);
            });

            renderPartSelect();
        }

        function renderPartSelect() {
            const partSelect = document.getElementById('partSelect');
            partSelect.innerHTML = '<option value="">Select a Part</option>';
            parts.forEach(part => {
                const option = document.createElement('option');
                option.value = part.id;
                option.textContent = part.name;
                partSelect.appendChild(option);
            });

            if (selectedPartId) {
                partSelect.value = selectedPartId;
                updateStockDisplay();
            }
        }

        function updateStockDisplay() {
            const part = parts.find(p => p.id === selectedPartId);
            const currentStock = document.getElementById('currentStock');
            const lowStockWarning = document.getElementById('lowStockWarning');
            if (part) {
                currentStock.textContent = part.quantity;
                lowStockWarning.style.display = part.quantity <= part.threshold ? 'block' : 'none';
            } else {
                currentStock.textContent = '0';
                lowStockWarning.style.display = 'none';
            }
        }

        function showAddPartModal() {
            document.getElementById('addPartName').value = '';
            document.getElementById('addPartSku').value = '';
            document.getElementById('addPartQuantity').value = '';
            document.getElementById('addPartThreshold').value = '';
            document.getElementById('addPartModal').style.display = 'flex';
        }

        function addPart() {
            const name = document.getElementById('addPartName').value.trim();
            const sku = document.getElementById('addPartSku').value.trim();
            const quantity = parseInt(document.getElementById('addPartQuantity').value) || 0;
            const threshold = parseInt(document.getElementById('addPartThreshold').value) || 0;

            if (!name || !sku) {
                alert('Name and SKU are required.');
                return;
            }

            const id = Date.now().toString();
            parts.push({ id, name, sku, quantity, threshold });
            saveParts();
            renderPartList();
            closeModal('addPartModal');
        }

        function showEditPartModal(id) {
            const part = parts.find(p => p.id === id);
            if (!part) return;
            document.getElementById('editPartId').value = id;
            document.getElementById('editPartName').value = part.name;
            document.getElementById('editPartSku').value = part.sku;
            document.getElementById('editPartQuantity').value = part.quantity;
            document.getElementById('editPartThreshold').value = part.threshold;
            document.getElementById('editPartModal').style.display = 'flex';
        }

        function savePartChanges() {
            const id = document.getElementById('editPartId').value;
            const name = document.getElementById('editPartName').value.trim();
            const sku = document.getElementById('editPartSku').value.trim();
            const quantity = parseInt(document.getElementById('editPartQuantity').value) || 0;
            const threshold = parseInt(document.getElementById('editPartThreshold').value) || 0;

            if (!name || !sku) {
                alert('Name and SKU are required.');
                return;
            }

            const index = parts.findIndex(p => p.id === id);
            if (index !== -1) {
                parts[index] = { id, name, sku, quantity, threshold };
                saveParts();
                renderPartList();
                if (selectedPartId === id) updateStockDisplay();
                closeModal('editPartModal');
            }
        }

        function showDeletePartModal(id) {
            const part = parts.find(p => p.id === id);
            if (!part) return;
            document.getElementById('deletePartId').value = id;
            document.getElementById('deletePartName').textContent = part.name;
            document.getElementById('deletePartModal').style.display = 'flex';
        }

        function deletePart() {
            const id = document.getElementById('deletePartId').value;
            parts = parts.filter(p => p.id !== id);
            if (selectedPartId === id) selectedPartId = null;
            saveParts();
            renderPartList();
            updateStockDisplay();
            closeModal('deletePartModal');
        }

        function showAddStockModal() {
            if (!selectedPartId) {
                alert('Please select a part first.');
                return;
            }
            const part = parts.find(p => p.id === selectedPartId);
            document.getElementById('addStockPartName').textContent = part.name;
            document.getElementById('addStockQuantity').value = '';
            document.getElementById('addStockModal').style.display = 'flex';
        }

        function addStock() {
            const quantity = parseInt(document.getElementById('addStockQuantity').value) || 0;
            if (quantity <= 0) {
                alert('Please enter a valid quantity.');
                return;
            }
            const part = parts.find(p => p.id === selectedPartId);
            if (part) {
                part.quantity += quantity;
                saveParts();
                renderPartList();
                updateStockDisplay();
                closeModal('addStockModal');
            }
        }

        function showRemoveStockModal() {
            if (!selectedPartId) {
                alert('Please select a part first.');
                return;
            }
            const part = parts.find(p => p.id === selectedPartId);
            document.getElementById('removeStockPartName').textContent = part.name;
            document.getElementById('removeStockQuantity').value = '';
            document.getElementById('removeStockModal').style.display = 'flex';
        }

        function removeStock() {
            const quantity = parseInt(document.getElementById('removeStockQuantity').value) || 0;
            if (quantity <= 0) {
                alert('Please enter a valid quantity.');
                return;
            }
            const part = parts.find(p => p.id === selectedPartId);
            if (part) {
                part.quantity = Math.max(0, part.quantity - quantity);
                saveParts();
                renderPartList();
                updateStockDisplay();
                closeModal('removeStockModal');
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function exportToCsv() {
            const headers = ['Name', 'SKU', 'Quantity', 'Low Stock Threshold'];
            const rows = parts.map(part => [
                `"${part.name.replace(/"/g, '""')}"`,
                part.sku,
                part.quantity,
                part.threshold
            ]);
            const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'inventory.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importFromCsv(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const rows = text.split('\n').map(row => row.split(',').map(cell => cell.trim().replace(/^"|"$/g, '').replace(/""/g, '"')));
                const headers = rows[0];
                if (headers[0] !== 'Name' || headers[1] !== 'SKU' || headers[2] !== 'Quantity' || headers[3] !== 'Low Stock Threshold') {
                    alert('Invalid CSV format.');
                    return;
                }
                parts = rows.slice(1).filter(row => row[0]).map(row => ({
                    id: Date.now().toString() + Math.random(),
                    name: row[0],
                    sku: row[1],
                    quantity: parseInt(row[2]) || 0,
                    threshold: parseInt(row[3]) || 0
                }));
                saveParts();
                renderPartList();
                document.getElementById('importFile').value = '';
            };
            reader.readAsText(file);
        }

        function showBomModal() {
            document.getElementById('bomFile').value = '';
            document.getElementById('bomResults').innerHTML = '';
            document.getElementById('bomModal').style.display = 'flex';
        }

        function compareBom() {
            const file = document.getElementById('bomFile').files[0];
            if (!file) {
                alert('Please select a BOM CSV file.');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const rows = text.split('\n').map(row => row.split(',').map(cell => cell.trim().replace(/^"|"$/g, '').replace(/""/g, '"')));
                const bomParts = rows.slice(1).filter(row => row[0]).map(row => ({
                    name: row[0],
                    quantity: parseInt(row[1]) || 0
                }));
                let results = '<h3>BOM Comparison Results</h3><ul>';
                bomParts.forEach(bomPart => {
                    const inventoryPart = parts.find(p => p.name.toLowerCase() === bomPart.name.toLowerCase());
                    if (!inventoryPart) {
                        results += `<li>${bomPart.name}: Not found in inventory. Required: ${bomPart.quantity}</li>`;
                    } else if (inventoryPart.quantity < bomPart.quantity) {
                        results += `<li>${bomPart.name}: Insufficient stock. Required: ${bomPart.quantity}, Available: ${inventoryPart.quantity}</li>`;
                    } else {
                        results += `<li>${bomPart.name}: Sufficient stock. Required: ${bomPart.quantity}, Available: ${inventoryPart.quantity}</li>`;
                    }
                });
                results += '</ul>';
                document.getElementById('bomResults').innerHTML = results;
            };
            reader.readAsText(file);
        }

        document.getElementById('partSelect').addEventListener('change', function() {
            selectedPartId = this.value;
            updateStockDisplay();
        });

        document.getElementById('reorderButton').addEventListener('click', function() {
            const part = parts.find(p => p.id === selectedPartId);
            if (part) {
                alert(`Initiate reorder for ${part.name}. Please contact supplier with SKU: ${part.sku}`);
            } else {
                alert('Please select a part to reorder.');
            }
        });

        renderPartList();
    </script>
</body>
</html>
